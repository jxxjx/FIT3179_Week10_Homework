{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {"text": "Tourism and GDP Quarterly Year on Year (YoY) Growth (%)", "fontSize": 20},
  "width": 820,
  "height": 360,
  "config": {
    "view": {"stroke": null},
    "axis": {"labelFontSize": 12, "titleFontSize": 12, "grid": true, "gridOpacity": 0.15}
  },

  "data": {
    "url": "https://raw.githubusercontent.com/jxxjx/FIT3179_Week9_Homework/main/gdp_qtr_real_supply_sub.csv",
    "format": {"type": "csv", "parse": {"date": "date"}}
  },

  "transform": [
    {"fold": ["gdp_yoy", "tourism_yoy"], "as": ["series", "value"]},
    {
      "calculate": "datum.series == 'gdp_yoy' ? 'GDP' : 'Tourism Arrival'",
      "as": "Series Label"
    }
  ],

  "layer": [
    {
      "mark": {"type": "rule", "strokeDash": [4,4], "opacity": 0.5},
      "encoding": {"y": {"datum": 0}}
    },
    {
      "mark": {"type": "line", "point": true, "strokeWidth": 3},
      "encoding": {
        "x": {
          "field": "date",
          "type": "temporal",
          "axis": {"title": null}
        },
        "y": {
          "field": "value",
          "type": "quantitative",
          "axis": {"title": "Growth (%)"}
        },
        "color": {
          "field": "Series Label",
          "type": "nominal",
          "scale": {
            "domain": ["GDP", "Tourism Arrival"],
            "range": ["#E31A59", "#1F5AA6"]
          },
          "legend": {"orient": "right", "title": null}
        },
        "tooltip": [
          {"field": "Series Label", "type": "nominal"},
          {"field": "date", "type": "temporal", "timeUnit": "yearquarter", "title": "Quarter"},
          {"field": "value", "type": "quantitative", "title": "YoY (%)", "format": ".1f"}
        ]
      }
    },
    {
      "transform": [
        {"window": [{"op": "rank", "as": "r"}], "groupby": ["Series Label"], "sort": [{"field": "date", "order": "ascending"}]},
        {"filter": "datum.r == max(datum.r)"}
      ],
      "mark": {"type": "text", "dx": 8, "dy": -6, "fontSize": 12},
      "encoding": {
        "x": {"field": "date", "type": "temporal"},
        "y": {"field": "value", "type": "quantitative"},
        "text": {"field": "Series Label"},
        "color": {
          "field": "Series Label",
          "type": "nominal",
          "scale": {"domain": ["GDP", "Tourism Arrival"], "range": ["#E31A59", "#1F5AA6"]},
          "legend": null
        }
      }
    }
  ]
}
